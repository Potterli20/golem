#
# Generated by @zondax/cli
#
VERSION 0.7
FROM alpine:3.17
ARG --global BASE_NAME=golem-dev

# Let's unify on a common place
WORKDIR /app

build-production:
    FROM golang:1.20

    ENV DEBIAN_FRONTEND=noninteractive
    RUN sed -i -e 's/deb\.debian\.org/mirror\.init7\.net/' /etc/apt/sources.list

    RUN apt-get update && \
        apt-get install -yy apt-utils python-is-python3 git openssh-server curl wget libc6 libstdc++6 ca-certificates tar bash

    RUN ssh-keygen -A
    RUN sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/" /etc/ssh/sshd_config
    RUN sed -i "s/#AllowTcpForwarding yes/AllowTcpForwarding yes/" /etc/ssh/sshd_config
    RUN sed -i "s/AllowTcpForwarding no/AllowTcpForwarding yes/" /etc/ssh/sshd_config
    RUN sed -i "s/GatewayPorts no/GatewayPorts yes/" /etc/ssh/sshd_config
    RUN mkdir -m 700 /root/.ssh

    EXPOSE 22
    EXPOSE 2000-30000 # expose a large amount, only development purposes

    CMD ["/usr/sbin/sshd", "-D"]

    DO ../+PUBLISH_WITH_FLEXTAGS --CONTAINER_FULLNAME=${BASE_NAME}

all:
    BUILD +build-production
