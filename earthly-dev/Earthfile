#
# Generated by @zondax/cli
#
VERSION 0.7
FROM alpine:3.17
ARG --global BASE_NAME=golem-dev

# Let's unify on a common place
WORKDIR /app

build-production:
    FROM golang:1.20-alpine

    RUN apk update \
    && apk --no-cache --update add build-base bash git openssh

    RUN ssh-keygen -A
    RUN sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/" /etc/ssh/sshd_config
    RUN sed -i "s/#AllowTcpForwarding yes/AllowTcpForwarding yes/" /etc/ssh/sshd_config
    RUN mkdir -m 700 /root/.ssh

    EXPOSE 22
    EXPOSE 2000-30000 # expose a large amount, only development purposes

    CMD ["/usr/sbin/sshd", "-D"]

    DO ../+PUBLISH_WITH_FLEXTAGS --CONTAINER_FULLNAME=${BASE_NAME}

all:
    BUILD +build-production
